
{
  "entities": {
    "Passport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Passport",
      "type": "object",
      "description": "Represents a digital passport for a harvest batch.",
      "properties": {
        "batchId": { "type": "string" },
        "blockchainId": { "type": "string" },
        "cropVariety": { "type": "string" },
        "location": { "type": "string" },
        "fertilizerUsage": { "type": "string" },
        "pesticideUsage": { "type": "string" },
        "waterUsage": { "type": "string" },
        "carbonFootprint": { "type": "string" }
      },
      "required": [
        "batchId",
        "blockchainId",
        "cropVariety",
        "location",
        "fertilizerUsage",
        "pesticideUsage",
        "waterUsage",
        "carbonFootprint"
      ]
    },
    "Farmer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Farmer",
      "type": "object",
      "description": "Represents a farmer using the AgroCast platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Farmer entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the farmer."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address of the farmer.",
          "format": "email"
        },
        "location": {
          "type": "string",
          "description": "Geographic location of the farmer's land."
        }
      },
      "required": [
        "id",
        "name",
        "contactEmail",
        "location"
      ]
    },
    "Land": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Land",
      "type": "object",
      "description": "Represents a piece of land owned or managed by a farmer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Land entity."
        },
        "farmerId": {
          "type": "string",
          "description": "Reference to Farmer. (Relationship: Farmer 1:N Land)"
        },
        "area": {
          "type": "number",
          "description": "Area of the land in acres/hectares."
        },
        "soilType": {
          "type": "string",
          "description": "Type of soil present in the land."
        },
        "location": {
          "type": "string",
          "description": "Geographic coordinates of the land."
        }
      },
      "required": [
        "id",
        "farmerId",
        "area",
        "soilType",
        "location"
      ]
    },
    "Crop": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Crop",
      "type": "object",
      "description": "Represents a specific crop that can be grown.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Crop entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the crop."
        },
        "growingCycle": {
          "type": "number",
          "description": "Growing cycle time of the crop in days."
        }
      },
      "required": [
        "id",
        "name",
        "growingCycle"
      ]
    },
    "ProfitPrediction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProfitPrediction",
      "type": "object",
      "description": "Represents the profit prediction for a specific crop on a specific land.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ProfitPrediction entity."
        },
        "landId": {
          "type": "string",
          "description": "Reference to Land. (Relationship: Land 1:N ProfitPrediction)"
        },
        "cropId": {
          "type": "string",
          "description": "Reference to Crop. (Relationship: Crop 1:N ProfitPrediction)"
        },
        "expectedRoi": {
          "type": "number",
          "description": "Expected return on investment."
        },
        "costBreakdown": {
          "type": "string",
          "description": "JSON string containing a cost breakdown of the profit prediction"
        },
        "historicalMarketPriceTrend": {
          "type": "string",
          "description": "JSON string containing the market price trend."
        }
      },
      "required": [
        "id",
        "landId",
        "cropId",
        "expectedRoi",
        "costBreakdown",
        "historicalMarketPriceTrend"
      ]
    },
    "ClimateRiskForecast": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClimateRiskForecast",
      "type": "object",
      "description": "Represents a climate risk forecast for a specific land area.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ClimateRiskForecast entity."
        },
        "landId": {
          "type": "string",
          "description": "Reference to Land. (Relationship: Land 1:N ClimateRiskForecast)"
        },
        "pestAttackProbability": {
          "type": "number",
          "description": "Probability of pest attack."
        },
        "cropDiseaseOutbreak": {
          "type": "number",
          "description": "Probability of crop disease outbreak."
        },
        "waterShortageRisk": {
          "type": "number",
          "description": "Risk of water shortage."
        },
        "extremeWeatherRisk": {
          "type": "number",
          "description": "Risk of extreme weather events."
        },
        "forecastDate": {
          "type": "string",
          "description": "Date for which the forecast is generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "landId",
        "pestAttackProbability",
        "cropDiseaseOutbreak",
        "waterShortageRisk",
        "extremeWeatherRisk",
        "forecastDate"
      ]
    },
    "HarvestBatch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HarvestBatch",
      "type": "object",
      "description": "Represents a harvest batch with blockchain traceability.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HarvestBatch entity (Blockchain ID)."
        },
        "landId": {
          "type": "string",
          "description": "Reference to Land where the harvest was collected. (Relationship: Land 1:N HarvestBatch)"
        },
        "cropId": {
          "type": "string",
          "description": "Reference to Crop harvested in this batch. (Relationship: Crop 1:N HarvestBatch)"
        },
        "fertilizerUsage": {
          "type": "string",
          "description": "Details of fertilizer usage."
        },
        "pesticideUsage": {
          "type": "string",
          "description": "Details of pesticide usage."
        },
        "waterUsage": {
          "type": "number",
          "description": "Amount of water used for the harvest."
        },
        "carbonFootprint": {
          "type": "number",
          "description": "Carbon footprint of the harvest."
        },
        "harvestDate": {
          "type": "string",
          "description": "Date when the harvest was collected.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "landId",
        "cropId",
        "fertilizerUsage",
        "pesticideUsage",
        "waterUsage",
        "carbonFootprint",
        "harvestDate"
      ]
    },
    "MarketplaceOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MarketplaceOffer",
      "type": "object",
      "description": "Represents an offer in the Agro-Match Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MarketplaceOffer entity."
        },
        "farmerId": {
          "type": "string",
          "description": "Reference to Farmer making the offer. (Relationship: Farmer 1:N MarketplaceOffer)"
        },
        "cropId": {
          "type": "string",
          "description": "Reference to Crop being offered. (Relationship: Crop 1:N MarketplaceOffer)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the crop being offered."
        },
        "price": {
          "type": "number",
          "description": "Price of the crop being offered."
        },
        "buyerId": {
          "type": "string",
          "description": "Reference to Buyer interested in the offer. (Relationship: Buyer 1:N MarketplaceOffer)"
        },
        "supplierId": {
          "type": "string",
          "description": "Reference to Supplier related to the offer."
        },
        "storageUnitId": {
          "type": "string",
          "description": "Reference to StorageUnit related to the offer."
        },
        "transportProviderId": {
          "type": "string",
          "description": "Reference to TransportProvider related to the offer."
        }
      },
      "required": [
        "id",
        "farmerId",
        "cropId",
        "quantity",
        "price"
      ]
    },
    "Buyer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Buyer",
      "type": "object",
      "description": "Represents a buyer in the Agro-Match Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Buyer entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the buyer."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address of the buyer.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "contactEmail"
      ]
    },
    "Supplier": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Supplier",
      "type": "object",
      "description": "Represents a supplier in the Agro-Match Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Supplier entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the supplier."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address of the supplier.",
          "format": "email"
        },
        "supplyType": {
          "type": "string",
          "description": "Type of supplies offered by the supplier."
        }
      },
      "required": [
        "id",
        "name",
        "contactEmail",
        "supplyType"
      ]
    },
    "StorageUnit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StorageUnit",
      "type": "object",
      "description": "Represents a storage unit in the Agro-Match Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StorageUnit entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the storage unit."
        },
        "location": {
          "type": "string",
          "description": "Location of the storage unit."
        },
        "capacity": {
          "type": "number",
          "description": "Storage capacity of the unit."
        }
      },
      "required": [
        "id",
        "name",
        "location",
        "capacity"
      ]
    },
    "TransportProvider": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransportProvider",
      "type": "object",
      "description": "Represents a transport provider in the Agro-Match Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TransportProvider entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the transport provider."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address of the transport provider.",
          "format": "email"
        },
        "transportType": {
          "type": "string",
          "description": "Type of transport provided."
        }
      },
      "required": [
        "id",
        "name",
        "contactEmail",
        "transportType"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/passports/{passportId}",
        "definition": {
          "entityName": "Passport",
          "schema": { "$ref": "#/backend/entities/Passport" },
          "description": "Stores digital passport documents.",
          "params": [{ "name": "passportId", "description": "The unique ID for the passport." }]
        }
      },
      {
        "path": "/users/{farmerId}",
        "definition": {
          "entityName": "Farmer",
          "schema": {
            "$ref": "#/backend/entities/Farmer"
          },
          "description": "Stores farmer profiles.  The 'farmerId' is used as the document ID. Provides a central location for user information and authentication.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            }
          ]
        }
      },
      {
        "path": "/users/{farmerId}/lands/{landId}",
        "definition": {
          "entityName": "Land",
          "schema": {
            "$ref": "#/backend/entities/Land"
          },
          "description": "Stores land details associated with a specific farmer. Includes denormalized 'farmerId' for authorization independence.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            },
            {
              "name": "landId",
              "description": "The unique identifier for the land."
            }
          ]
        }
      },
      {
        "path": "/crops/{cropId}",
        "definition": {
          "entityName": "Crop",
          "schema": {
            "$ref": "#/backend/entities/Crop"
          },
          "description": "Stores crop information. Accessible to all users, potentially read-only for non-admin users.",
          "params": [
            {
              "name": "cropId",
              "description": "The unique identifier for the crop."
            }
          ]
        }
      },
      {
        "path": "/users/{farmerId}/lands/{landId}/profit_predictions/{profitPredictionId}",
        "definition": {
          "entityName": "ProfitPrediction",
          "schema": {
            "$ref": "#/backend/entities/ProfitPrediction"
          },
          "description": "Stores profit predictions for a specific land associated with a farmer. Includes denormalized 'farmerId' and 'landId' for authorization independence.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            },
            {
              "name": "landId",
              "description": "The unique identifier for the land."
            },
            {
              "name": "profitPredictionId",
              "description": "The unique identifier for the profit prediction."
            }
          ]
        }
      },
      {
        "path": "/users/{farmerId}/lands/{landId}/climate_risk_forecasts/{climateRiskForecastId}",
        "definition": {
          "entityName": "ClimateRiskForecast",
          "schema": {
            "$ref": "#/backend/entities/ClimateRiskForecast"
          },
          "description": "Stores climate risk forecasts for a specific land owned by a farmer. Includes denormalized 'farmerId' and 'landId' for authorization independence.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            },
            {
              "name": "landId",
              "description": "The unique identifier for the land."
            },
            {
              "name": "climateRiskForecastId",
              "description": "The unique identifier for the climate risk forecast."
            }
          ]
        }
      },
      {
        "path": "/users/{farmerId}/lands/{landId}/harvest_batches/{harvestBatchId}",
        "definition": {
          "entityName": "HarvestBatch",
          "schema": {
            "$ref": "#/backend/entities/HarvestBatch"
          },
          "description": "Stores harvest batch information for a specific land owned by a farmer. Includes denormalized 'farmerId' and 'landId' for authorization independence.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            },
            {
              "name": "landId",
              "description": "The unique identifier for the land."
            },
            {
              "name": "harvestBatchId",
              "description": "The unique identifier for the harvest batch."
            }
          ]
        }
      },
      {
        "path": "/marketplace_offers/{marketplaceOfferId}",
        "definition": {
          "entityName": "MarketplaceOffer",
          "schema": {
            "$ref": "#/backend/entities/MarketplaceOffer"
          },
          "description": "Stores marketplace offers. Includes denormalized 'farmerId' for authorization independence.",
          "params": [
            {
              "name": "marketplaceOfferId",
              "description": "The unique identifier for the marketplace offer."
            }
          ]
        }
      },
      {
        "path": "/buyers/{buyerId}",
        "definition": {
          "entityName": "Buyer",
          "schema": {
            "$ref": "#/backend/entities/Buyer"
          },
          "description": "Stores buyer profiles in the marketplace.",
          "params": [
            {
              "name": "buyerId",
              "description": "The unique identifier for the buyer."
            }
          ]
        }
      },
      {
        "path": "/suppliers/{supplierId}",
        "definition": {
          "entityName": "Supplier",
          "schema": {
            "$ref": "#/backend/entities/Supplier"
          },
          "description": "Stores supplier profiles in the marketplace.",
          "params": [
            {
              "name": "supplierId",
              "description": "The unique identifier for the supplier."
            }
          ]
        }
      },
      {
        "path": "/storage_units/{storageUnitId}",
        "definition": {
          "entityName": "StorageUnit",
          "schema": {
            "$ref": "#/backend/entities/StorageUnit"
          },
          "description": "Stores storage unit information in the marketplace.",
          "params": [
            {
              "name": "storageUnitId",
              "description": "The unique identifier for the storage unit."
            }
          ]
        }
      },
      {
        "path": "/transport_providers/{transportProviderId}",
        "definition": {
          "entityName": "TransportProvider",
          "schema": {
            "$ref": "#/backend/entities/TransportProvider"
          },
          "description": "Stores transport provider information in the marketplace.",
          "params": [
            {
              "name": "transportProviderId",
              "description": "The unique identifier for the transport provider."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support AgroCast's core features: AI-Based Climate Risk Forecast, Profit Prediction Engine, Agro-Match Marketplace, and Blockchain-Backed Farm Digital Passport. The structure prioritizes authorization independence, clarity, and scalability.\n\n**Farmers and Related Data:** Farmers and their associated data (Land, ProfitPrediction, ClimateRiskForecast, HarvestBatch, and MarketplaceOffer) are stored under the `/users/{farmerId}` path to ensure that only the authenticated farmer can access and modify their data. The farmer's `id` is used as the document ID for their profile in the `/users` collection. The `farmerId` is denormalized into the Land, MarketplaceOffer collections to ensure Authorization Independence.\n\n**Crops:** Crops data is stored in a top-level `/crops` collection. This is because crops are global and not owned by specific users, ensuring that any user can access crop information. This collection will be read-only for most users, with admin access to modify.\n\n**Marketplace Data:** The MarketplaceOffer entities are stored in the `/marketplace_offers` collection. This segregation, instead of nesting under farmer, is to facilitate listing and querying of offers across all farmers, supporting the Agro-Match Marketplace feature. The `farmerId` is included in each `MarketplaceOffer` document to link it back to the farmer who created it, and to implement security rules based on ownership.\n\n**Buyers, Suppliers, StorageUnits and TransportProviders:** Stored in top-level collections as they are considered global entities that can be accessed by all farmers. This allows for easy querying and matching in the Agro-Match Marketplace.\n\n**Authorization Independence:** Authorization independence is achieved by denormalizing the `farmerId` into the `lands`, `marketplace_offers`, `profit_predictions`, `climate_risk_forecasts`, and `harvest_batches` collections. This eliminates the need for `get()` calls in the security rules to verify ownership, allowing atomic operations and improving performance.\n\n**QAPs Support:**\n\n*   **Secure List Operations:** The segregation of data into user-owned subcollections and global collections (crops, marketplace) ensures that list operations can be securely performed based on the user's role and ownership.  Rules can simply check the requesting user's ID against the `farmerId` in the documents to prevent unauthorized listing.\n\n*   **Membership Model:**  The `marketplace_offers` collection uses the `farmerId` field to implement a membership model for ownership. Security rules can easily verify if the requesting user is the owner (farmer) of the marketplace offer."
  }
}
